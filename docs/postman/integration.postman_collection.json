{
  "info": {
    "_postman_id": "df36aa1c-4bd6-4773-98d9-a1947f0d545d",
    "name": "Integration Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "50720942",
    "_collection_link": "https://andry06082002-6699507.postman.co/workspace/Andrea-Riolo's-Workspace~d84244a4-348e-4b8a-81a5-c012262a2e6b/collection/50720942-df36aa1c-4bd6-4773-98d9-a1947f0d545d?action=share&source=collection_link&creator=50720942"
  },
  "item": [
    {
      "name": "0.1 Invalid User Email",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 400\", function() {",
              "    pm.response.to.have.status(400);",
              "})"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"nomail\",\n    \"password\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/register",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "register"
          ]
        }
      },
      "response": []
    },
    {
      "name": "0.2 Invalid User Data",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 400\", function() {",
              "    pm.response.to.have.status(400);",
              "})"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"test\": \"nomail\",\n    \"test2\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/register",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "register"
          ]
        }
      },
      "response": []
    },
    {
      "name": "1. User [1] Registration",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Generate a random string to make the email unique",
              "const randomString = Math.random().toString(36).substring(7);",
              "const userEmail = `testuser_${randomString}@example.com`;",
              "",
              "// Save this to a Collection Variable so other requests (like Login) can access it",
              "pm.collectionVariables.set(\"email1\", userEmail);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function() {",
              "    pm.response.to.have.status(201);",
              "})"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"{{email1}}\",\n    \"password\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/register",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "register"
          ]
        }
      },
      "response": []
    },
    {
      "name": "1. User [2] Registration",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Generate a random string to make the email unique",
              "const randomString = Math.random().toString(36).substring(7);",
              "const userEmail = `testuser_${randomString}@example.com`;",
              "",
              "// Save this to a Collection Variable so other requests (like Login) can access it",
              "pm.collectionVariables.set(\"email2\", userEmail);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function() {",
              "    pm.response.to.have.status(201);",
              "})"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"{{email2}}\",\n    \"password\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/register",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "register"
          ]
        }
      },
      "response": []
    },
    {
      "name": "2. User [1] Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 1. Assert that the status code is 200 OK",
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Extract and save the token if the request was successful",
              "pm.test(\"Save data to Collection Variables\", function () {",
              "    // Only parse if the request was successful",
              "    pm.expect(pm.response.code).to.eql(200);",
              "    ",
              "    var jsonData = pm.response.json();",
              "",
              "    // Verify the key exists in the response body to prevent saving 'undefined'",
              "    pm.expect(jsonData).to.have.property(\"access_token\");",
              "    pm.expect(jsonData).to.have.property(\"user_id\");",
              "",
              "    // Save the token to the Collection Variables",
              "    pm.collectionVariables.set(\"jwt_token1\", jsonData.access_token);",
              "    pm.collectionVariables.set(\"user_id1\", jsonData.user_id);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"{{email1}}\",\n    \"password\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/login",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "login"
          ]
        }
      },
      "response": []
    },
    {
      "name": "2. User [2] Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// 1. Assert that the status code is 200 OK",
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// 2. Extract and save the token if the request was successful",
              "pm.test(\"Save data to Collection Variables\", function () {",
              "    // Only parse if the request was successful",
              "    pm.expect(pm.response.code).to.eql(200);",
              "    ",
              "    var jsonData = pm.response.json();",
              "",
              "    // Verify the key exists in the response body to prevent saving 'undefined'",
              "    pm.expect(jsonData).to.have.property(\"access_token\");",
              "    pm.expect(jsonData).to.have.property(\"user_id\");",
              "",
              "    // Save the token to the Collection Variables",
              "    pm.collectionVariables.set(\"jwt_token2\", jsonData.access_token);",
              "    pm.collectionVariables.set(\"user_id2\", jsonData.user_id);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"{{email2}}\",\n    \"password\": \"me\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/login",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "login"
          ]
        }
      },
      "response": []
    },
    {
      "name": "3. Create User [1] Profile",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 201 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(201);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username1\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id1\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region1\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Generate a random string to make the username unique",
              "const randomString = Math.random().toString(36).substring(7);",
              "const username = `testplayer_${randomString}`;",
              "",
              "// Save this to a Collection Variable so other requests (like Login) can access it",
              "pm.collectionVariables.set(\"username1\", username);",
              "",
              "// 1. Define your array of strings",
              "const regions = [",
              "    \"Sicilia\",",
              "    \"Toscana\",",
              "    \"Abruzzo\",",
              "    \"Campania\",",
              "    \"Calabria\",",
              "    \"Lazio\"",
              "];",
              "",
              "// 2. Pick a random index based on the array length",
              "const randomIndex = Math.floor(Math.random() * regions.length);",
              "",
              "// 3. Select the string",
              "const selectedRegion = regions[randomIndex];",
              "",
              "// 4. Save it to a variable so you can use it in the Body/URL",
              "pm.collectionVariables.set(\"region1\", selectedRegion);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\" : \"{{username1}}\",\n    \"region\": \"{{region1}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/players",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players"
          ]
        }
      },
      "response": []
    },
    {
      "name": "3. Create User [2] Profile",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 201 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(201);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id2\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region2\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Generate a random string to make the username unique",
              "const randomString = Math.random().toString(36).substring(7);",
              "const username = `testplayer_${randomString}`;",
              "",
              "// Save this to a Collection Variable so other requests (like Login) can access it",
              "pm.collectionVariables.set(\"username2\", username);",
              "",
              "// 1. Define your array of strings",
              "const regions = [",
              "    \"Sicilia\",",
              "    \"Toscana\",",
              "    \"Abruzzo\",",
              "    \"Campania\",",
              "    \"Calabria\",",
              "    \"Lazio\"",
              "];",
              "",
              "// 2. Pick a random index based on the array length",
              "const randomIndex = Math.floor(Math.random() * regions.length);",
              "",
              "// 3. Select the string",
              "const selectedRegion = regions[randomIndex];",
              "",
              "// 4. Save it to a variable so you can use it in the Body/URL",
              "pm.collectionVariables.set(\"region2\", selectedRegion);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"username\" : \"{{username2}}\",\n    \"region\": \"{{region2}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/players",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players"
          ]
        }
      },
      "response": []
    },
    {
      "name": "4. Update User [1] Profile",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property(\"user_id\");",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert content of such fields",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region1\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id1\"));",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username1\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 1. Define your array of strings",
              "const regions = [",
              "    \"Sicilia\",",
              "    \"Toscana\",",
              "    \"Abruzzo\",",
              "    \"Campania\",",
              "    \"Calabria\",",
              "    \"Lazio\"",
              "];",
              "",
              "// 2. Pick a random index based on the array length",
              "const randomIndex = Math.floor(Math.random() * regions.length);",
              "",
              "// 3. Select the string",
              "const selectedRegion = regions[randomIndex];",
              "",
              "// 4. Save it to a variable so you can use it in the Body/URL",
              "pm.collectionVariables.set(\"region1\", selectedRegion);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "PATCH",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"region\": \"{{region1}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/players/me",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me"
          ]
        }
      },
      "response": []
    },
    {
      "name": "4. Update User [2] Profile",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property(\"user_id\");",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert content of such fields",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region2\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id2\"));",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// 1. Define your array of strings",
              "const regions = [",
              "    \"Sicilia\",",
              "    \"Toscana\",",
              "    \"Abruzzo\",",
              "    \"Campania\",",
              "    \"Calabria\",",
              "    \"Lazio\"",
              "];",
              "",
              "// 2. Pick a random index based on the array length",
              "const randomIndex = Math.floor(Math.random() * regions.length);",
              "",
              "// 3. Select the string",
              "const selectedRegion = regions[randomIndex];",
              "",
              "// 4. Save it to a variable so you can use it in the Body/URL",
              "pm.collectionVariables.set(\"region2\", selectedRegion);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "PATCH",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"region\": \"{{region2}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/players/me",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me"
          ]
        }
      },
      "response": []
    },
    {
      "name": "5. Get User [1] Profile By ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username1\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id1\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region1\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/{{user_id1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "{{user_id1}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "5. Get User [2] Profile By ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id2\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region2\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/{{user_id2}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "{{user_id2}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "6. Get User [1] Profile By Username",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username1\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id1\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region1\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/search/{{username1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "search",
            "{{username1}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "6. Get User [2] Profile By Username",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Response is 200 and has appropriate fields\", function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('username');",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    pm.expect(jsonData).to.have.property('region');",
              "",
              "    // Assert data is consistent",
              "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "    pm.expect(jsonData.user_id).to.eql(pm.collectionVariables.get(\"user_id2\"));",
              "    pm.expect(jsonData.region).to.eql(pm.collectionVariables.get(\"region2\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/search/{{username2}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "search",
            "{{username2}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "7. Enqueue User [1] (first pass)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"User1 queued and waiting\", function () {",
              "      pm.expect(pm.response.code).to.be.oneOf([200, 202]);",
              "      pm.expect(data.status).to.eql(\"Waiting\");",
              "      pm.expect(data).to.have.property(\"queue_token\");",
              "  });",
              "",
              "  pm.collectionVariables.set(\"queue_token1\", data.queue_token);",
              "  pm.collectionVariables.unset(\"match_id1\");",
              "  pm.collectionVariables.set(\"queue_status1\", data.status);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/enqueue",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "enqueue"
          ]
        }
      },
      "response": []
    },
    {
      "name": "8. Queue Status User [1] (Waiting)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Queue status shows waiting\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"Waiting\");",
              "      pm.expect(data.queue_token).to.eql(pm.collectionVariables.get(\"queue_token1\"));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/status?token={{queue_token1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "status"
          ],
          "query": [
            {
              "key": "token",
              "value": "{{queue_token1}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "9. Dequeue User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"User1 dequeued\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"Removed\");",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"token\": \"{{queue_token1}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/dequeue",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "dequeue"
          ]
        }
      },
      "response": []
    },
    {
      "name": "10. Re-Enqueue User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"User1 re-queued\", function () {",
              "      pm.expect(pm.response.code).to.be.oneOf([200, 202]);",
              "      pm.expect(data.status).to.eql(\"Waiting\");",
              "      pm.expect(data.queue_token).to.be.a(\"string\");",
              "  });",
              "",
              "  pm.collectionVariables.set(\"queue_token1\", data.queue_token);",
              "  pm.collectionVariables.set(\"queue_status1\", data.status);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/enqueue",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "enqueue"
          ]
        }
      },
      "response": []
    },

    {
      "name": "11. Enqueue User [2] (Match)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"User2 matched\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"Matched\");",
              "      pm.expect(data).to.have.property(\"match_id\");",
              "  });",
              "",
              "  pm.collectionVariables.set(\"queue_token2\", data.queue_token);",
              "  pm.collectionVariables.set(\"match_id2\", data.match_id);",
              "  pm.collectionVariables.set(\"match_id1\", data.match_id);",
              "  pm.collectionVariables.set(\"opponent_id2\", data.opponent_id);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/enqueue",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "enqueue"
          ]
        }
      },
      "response": []
    },
    {
      "name": "12. Queue Status User [1] (Matched)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"User1 sees match\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"Matched\");",
              "      pm.expect(data.match_id).to.eql(Number(pm.collectionVariables.get(\"match_id2\")));",
              "      pm.expect(data.opponent_id).to.eql(pm.collectionVariables.get(\"user_id2\"));",
              "  });",
              "",
              "  pm.collectionVariables.set(\"match_id1\", data.match_id);",
              "  pm.collectionVariables.set(\"opponent_id1\", data.opponent_id);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/status?token={{queue_token1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "status"
          ],
          "query": [
            {
              "key": "token",
              "value": "{{queue_token1}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "13. Dequeue User [1] Too Late",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Cannot dequeue after match\", function () {",
              "      pm.response.to.have.status(409);",
              "      pm.expect(data.status).to.eql(\"TooLate\");",
              "      pm.expect(data.match_id).to.eql(Number(pm.collectionVariables.get(\"match_id1\")));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"token\": \"{{queue_token1}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/dequeue",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "dequeue"
          ]
        }
      },
      "response": []
    },

    {
      "name": "14. Submit Deck User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Deck accepted for user1\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.id).to.eql(Number(pm.collectionVariables.get(\"match_id1\")));",
              "      pm.expect(data.status).to.eql(\"SETUP\");",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"data\": {{deck1_cards}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/deck",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "deck"
          ]
        }
      },
      "response": []
    },
    {
      "name": "15. Submit Deck User [2]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Deck accepted for user2 and match started\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.id).to.eql(Number(pm.collectionVariables.get(\"match_id2\")));",
              "      pm.expect(data.status).to.eql(\"IN_PROGRESS\");",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"data\": {{deck2_cards}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/deck",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "deck"
          ]
        }
      },
      "response": []
    },
    {
      "name": "16. Current Round Status (Start)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Round 1 created\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.current_round_number).to.eql(1);",
              "      pm.expect(data.round_status).to.eql(\"WAITING_FOR_BOTH_PLAYERS\");",
              "  });",
              "  pm.collectionVariables.set(\"round_category\", data.current_category);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/round",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "round"
          ]
        }
      },
      "response": []
    },
    {
      "name": "17. Move Round 1 - User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"First move queued\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"WAITING_FOR_OPPONENT\");",
              "      pm.expect(data.round.round_number).to.eql(1);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p1_move_r1}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/moves/1",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "moves",
            "1"
          ]
        }
      },
      "response": []
    },
    {
      "name": "18. Move Round 1 - User [2]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Round 1 processed\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"ROUND_PROCESSED\");",
              "      pm.expect(data.next_round).to.eql(2);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p2_move_r1}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/moves/1",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "moves",
            "1"
          ]
        }
      },
      "response": []
    },
    {
      "name": "19. Match History After Round 1",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"History shows processed round and next one\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.rounds.length).to.be.at.least(2);",
              "      pm.expect(data.rounds[0].round_number).to.eql(1);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/history",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "history"
          ]
        }
      },
      "response": []
    },
    {
      "name": "20. Move Round 2 - User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Second round move accepted\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json().status).to.eql(\"WAITING_FOR_OPPONENT\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p1_move_r2}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/moves/2",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "moves",
            "2"
          ]
        }
      },
      "response": []
    },
    {
      "name": "21. Move Round 2 - User [2]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Round 2 processed\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"ROUND_PROCESSED\");",
              "      pm.expect(data.next_round).to.eql(3);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p2_move_r2}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/moves/2",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "moves",
            "2"
          ]
        }
      },
      "response": []
    },
    {
      "name": "22. Move Round 3 - User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Round 3 move accepted\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json().status).to.eql(\"WAITING_FOR_OPPONENT\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p1_move_r3}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/moves/3",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "moves",
            "3"
          ]
        }
      },
      "response": []
    },
    {
      "name": "23. Move Round 3 - User [2]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Round 3 processed\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"ROUND_PROCESSED\");",
              "      pm.expect(data.next_round).to.eql(4);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p2_move_r3}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/moves/3",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "moves",
            "3"
          ]
        }
      },
      "response": []
    },
    {
      "name": "24. Move Round 4 - User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Round 4 move accepted\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json().status).to.eql(\"WAITING_FOR_OPPONENT\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p1_move_r4}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/moves/4",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "moves",
            "4"
          ]
        }
      },
      "response": []
    },
    {
      "name": "25. Move Round 4 - User [2]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Round 4 processed\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"ROUND_PROCESSED\");",
              "      pm.expect(data.next_round).to.eql(5);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p2_move_r4}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/moves/4",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "moves",
            "4"
          ]
        }
      },
      "response": []
    },
    {
      "name": "26. Move Round 5 - User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Final round move accepted\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json().status).to.eql(\"WAITING_FOR_OPPONENT\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p1_move_r5}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/moves/5",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "moves",
            "5"
          ]
        }
      },
      "response": []
    },
    {
      "name": "27. Move Round 5 - User [2] (Finish)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Match finished after round 5\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"ROUND_PROCESSED\");",
              "      pm.expect(data.game_status).to.eql(\"FINISHED\");",
              "      pm.expect(data.next_round).to.be.null;",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"card_id\": {{p2_move_r5}}\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/matches/{{match_id2}}/moves/5",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id2}}",
            "moves",
            "5"
          ]
        }
      },
      "response": []
    },
    {
      "name": "28. Match Status Final",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Match is finished\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"FINISHED\");",
              "      pm.expect(data.id).to.eql(Number(pm.collectionVariables.get(\"match_id1\")));",
              "  });",
              "  pm.collectionVariables.set(\"winner_id\", data.winner_id);",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "29. Full Match History Final",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"All 5 rounds recorded\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.rounds.length).to.eql(5);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/matches/{{match_id1}}/history",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "{{match_id1}}",
            "history"
          ]
        }
      },
      "response": []
    },
    {
      "name": "30. Player [1] History",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Player history available\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.player_id).to.eql(Number(pm.collectionVariables.get(\"user_id1\")));",
              "      pm.expect(data.matches.length).to.be.at.least(1);",
              "      pm.expect(data.summary.total_matches).to.be.at.least(1);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/matches/history/{{user_id1}}?status=finished&limit=5",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "matches",
            "history",
            "{{user_id1}}"
          ],
          "query": [
            {
              "key": "status",
              "value": "finished"
            },
            {
              "key": "limit",
              "value": "5"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "31. Leaderboard",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Leaderboard populated\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.leaderboard).to.be.an(\"array\");",
              "      pm.expect(data.leaderboard.length).to.be.at.least(1);",
              "  });",
              "  pm.test(\"Players appear in leaderboard\", function () {",
              "      const ids = data.leaderboard.map(row => row.player_id);",
              "      pm.expect(ids).to.include(Number(pm.collectionVariables.get(\"user_id1\")));",
              "      pm.expect(ids).to.include(Number(pm.collectionVariables.get(\"user_id2\")));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/leaderboard?limit=10",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "leaderboard"
          ],
          "query": [
            {
              "key": "limit",
              "value": "10"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "32. Catalogue Get All Cards",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Fetched catalogue\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.data).to.be.an(\"array\");",
              "      pm.expect(data.data.length).to.be.above(0);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/cards",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "cards"
          ]
        }
      },
      "response": []
    },
    {
      "name": "33. Catalogue Get Single Card",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "",
              "  pm.test(\"Single card found\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data).to.have.property(\"name\");",
              "      pm.expect(data.id).to.eql(Number(pm.collectionVariables.get(\"catalogue_card_id\")));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/cards/{{catalogue_card_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "cards",
            "{{catalogue_card_id}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "34. Catalogue Get Missing Card",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Missing card returns 404\", function () {",
              "    pm.response.to.have.status(404);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/cards/{{missing_card_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "cards",
            "{{missing_card_id}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "35. Friendship Send Request",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "  pm.test(\"Friend request sent\", function () {",
              "      pm.response.to.have.status(201);",
              "      pm.expect(data.msg).to.match(/Friend request sent/i);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/me/friends/{{username2}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me",
            "friends",
            "{{username2}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "36. Friendship Status Pending",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "  pm.test(\"Friendship pending\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"pending\");",
              "      pm.expect(data.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/me/friends/{{username2}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me",
            "friends",
            "{{username2}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "37. Friendship Accept Request",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "  pm.test(\"Friend request accepted\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.msg).to.match(/accepted/i);",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token2}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"accepted\": true\n}"
        },
        "url": {
          "raw": "{{base_url}}/players/me/friends/{{username1}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me",
            "friends",
            "{{username1}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "38. Friendship Status Accepted",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "  pm.test(\"Friendship accepted\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.status).to.eql(\"accepted\");",
              "      pm.expect(data.username).to.eql(pm.collectionVariables.get(\"username2\"));",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/me/friends/{{username2}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me",
            "friends",
            "{{username2}}"
          ]
        }
      },
      "response": []
    },
    {
      "name": "39. Friendship List User [1]",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "(() => {",
              "  const data = pm.response.json();",
              "  pm.test(\"Friends list includes user2\", function () {",
              "      pm.response.to.have.status(200);",
              "      pm.expect(data.data).to.be.an(\"array\");",
              "      const entry = data.data.find(f => f.username === pm.collectionVariables.get(\"username2\"));",
              "      pm.expect(entry).to.not.be.undefined;",
              "      pm.expect(entry.status).to.eql(\"accepted\");",
              "  });",
              "})();"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{jwt_token1}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/players/me/friends",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "players",
            "me",
            "friends"
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    { "key": "cur_user_email", "value": "" },
    { "key": "jwt_token", "value": "" },
    { "key": "user_id", "value": "" },
    { "key": "username", "value": "" },
    { "key": "region", "value": "" },
    { "key": "region1", "value": "" },
    { "key": "email1", "value": "" },
    { "key": "jwt_token1", "value": "" },
    { "key": "user_id1", "value": "" },
    { "key": "username1", "value": "" },
    { "key": "email2", "value": "" },
    { "key": "jwt_token2", "value": "" },
    { "key": "user_id2", "value": "" },
    { "key": "username2", "value": "" },
    { "key": "region2", "value": "" },
    { "key": "queue_token1", "value": "" },
    { "key": "queue_token2", "value": "" },
    { "key": "match_id1", "value": "" },
    { "key": "match_id2", "value": "" },
    { "key": "deck1_cards", "value": "[8, 9, 12, 16, 7]" },
    { "key": "deck2_cards", "value": "[4, 15, 13, 14, 5]" },
    { "key": "p1_move_r1", "value": "8" },
    { "key": "p1_move_r2", "value": "9" },
    { "key": "p1_move_r3", "value": "12" },
    { "key": "p1_move_r4", "value": "16" },
    { "key": "p1_move_r5", "value": "7" },
    { "key": "p2_move_r1", "value": "4" },
    { "key": "p2_move_r2", "value": "15" },
    { "key": "p2_move_r3", "value": "13" },
    { "key": "p2_move_r4", "value": "14" },
    { "key": "p2_move_r5", "value": "5" },
    { "key": "catalogue_card_id", "value": "8" },
    { "key": "missing_card_id", "value": "99999" },
    { "key": "invalid_deck", "value": "[-1, -2, -3]" },
    { "key": "queue_status1", "value": "" },
    { "key": "opponent_id2", "value": "" },
    { "key": "opponent_id1", "value": "" },
    { "key": "round_category", "value": "" },
    { "key": "winner_id", "value": "" }
  ]
}
